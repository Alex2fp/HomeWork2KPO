# HSE Bank — Учёт финансов (Console)

## Описание
Консольное приложение, демонстрирующее управление личными финансами без базы данных. Пользователь может создавать счета, категории, операции, смотреть аналитику по балансам и группировкам, а также импортировать и экспортировать данные в форматах CSV, JSON и YAML.

Приложение построено по принципам SOLID и GRASP, использует DI-контейнер и ряд паттернов GoF для разделения ответственности и повторного использования логики.

## Запуск
```
dotnet run --project src/FinanceApp/FinanceApp.csproj
```

> В среде проверки .NET SDK может быть недоступен. В этом случае достаточно изучить исходный код.

## Архитектура и паттерны
- **Фасад** — `FinanceFacade` инкапсулирует работу с репозиторием, импортом/экспортом и аналитикой.
- **Команда** — `RecalculateBalanceCommand` пересчитывает баланс счёта по операциям, создаётся через `CommandFactory`.
- **Декоратор** — `AnalyticsTimingDecorator` измеряет время выполнения аналитики.
- **Шаблонный метод** — абстрактный `FinanceDataImporter` определяет алгоритм импорта, конкретные форматы реализованы в `CsvFinanceDataImporter`, `JsonFinanceDataImporter`, `YamlFinanceDataImporter`.
- **Посетитель** — `CollectingExportVisitor` и его наследники формируют экспорт в разные форматы.
- **Фабрика** — `FinanceDataImporterFactory` подбирает импортер по формату.

### SOLID & GRASP
- **Single Responsibility** — репозиторий отвечает за хранение, аналитика за расчёты, фасад за сценарии пользователя.
- **Open/Closed** — импортеры и экспортёры легко расширяются новыми форматами.
- **Liskov Substitution** — интерфейсы сервисов допускают взаимозаменяемые реализации.
- **Interface Segregation** — специализированные интерфейсы (`IFinanceFacade`, `IAnalyticsService`, `IFinanceDataExportService`).
- **Dependency Inversion** — зависимости описаны через интерфейсы и внедряются DI-контейнером.
- **High Cohesion / Low Coupling** — каждый модуль сфокусирован на собственной задаче и слабо связан с другими.

## Основные сценарии
1. **Счета** — создание, переименование, удаление. Баланс обновляется автоматически по операциям и может быть пересчитан командой.
2. **Категории** — CRUD, поддержка типов (доход, расход, универсальная).
3. **Операции** — добавление и удаление доходов/расходов, проверка совместимости категорий.
4. **Аналитика** — баланс счёта, суммарные доходы/расходы, разница, группировка по категориям с подсчётом чистого результата.
5. **Импорт/экспорт** — поддержка CSV/JSON/YAML, импорт применяет снапшот в репозиторий.
6. **Диагностика** — время выполнения аналитики выводится в консоль.

## Структура проекта
```
src/FinanceApp/
  Domain/                // Доменная модель
  Application/
    Repositories/        // Репозиторий и интерфейсы доступа к данным
    Analytics/           // Сервисы аналитики и декораторы
    Importing/           // Импорт данных (Template Method, Factory)
    Exporting/           // Экспорт данных (Visitor)
    Commands/            // Паттерн Команда
    Facade/              // Фасад приложения
    Data/                // Переносимые модели данных
  Presentation/          // Консольный интерфейс
  Program.cs             // Точка входа и настройка DI
```

## Дополнительно
- В коде предусмотрены базовые проверки инвариантов (положительная сумма операций, уникальность имён и т.д.).
- `Seed` в `Program.cs` создаёт демонстрационные данные для быстрого старта.
- Лог измерения аналитики выводится в консоль в формате `[METRICS] ...`.
